# Sistema de Internacionalización (i18n)

Tu aplicación habla inglés, español, y lo que quieras añadir.

## Enfoque Moderno: Messages.ts por BO

Cada Business Object tiene su propio archivo de mensajes **tipado en TypeScript**.

**AuthMessages.ts**

```typescript
export const AuthMessages = {
    es: {
        loginSuccess: 'Sesión iniciada exitosamente',
        registerSuccess: 'Usuario registrado exitosamente',
        validation: {
            emailRequired: 'El email es requerido',
            passwordTooShort: 'La contraseña debe tener al menos 8 caracteres',
        },
        welcomeBack: 'Bienvenido de nuevo, {name}',
    },
    en: {
        loginSuccess: 'Login successful',
        registerSuccess: 'User registered successfully',
        validation: {
            emailRequired: 'Email is required',
            passwordTooShort: 'Password must be at least 8 characters',
        },
        welcomeBack: 'Welcome back, {name}',
    },
}
```

## Uso en Business Objects

### 1. Accessor `this.m` (Recomendado)

Usa el getter tipado `this.m` para acceder a los mensajes del idioma actual.

```typescript
import { AuthMessages } from './AuthMessages.js'

export class AuthBO extends BaseBO {
    private get m() {
        return this.i18n.use(AuthMessages)
    }

    async register(params: RegisterInput): Promise<ApiResponse> {
        // ...
        return this.created(null, this.m.registerSuccess) // ← Tipado y autocompletado
    }
}
```

### 2. Interpolación (Variables)

Usa `{variable}` en el string y `i18n.format()` para interpolar.

````typescript
```typescript
const msg = this.i18n.format(this.m.welcomeBack, { name: 'Eliab' })
// "Bienvenido de nuevo, Eliab"
````

## Mensajes Globales (Errors, Success, Alerts)

Para mensajes generales de la aplicación (errores de servidor, alertas comunes), usa `this.i18n.messages`. Esto reemplaza el uso antiguo de `i18n.get('string')`.

```typescript
// Acceso 100% tipado a mensajes globales
const error = this.i18n.messages.errors.client.invalidParameters

// Uso en controladores
res.status(error.code).send(error)
```

## Claves i18n en Schemas Zod

Los schemas Zod usan **claves de traducción** (strings) que se resuelven en tiempo de ejecución.

```typescript
// AuthSchemas.ts
export const AuthSchemas = {
    login: z.object({
        email: z.string().email('bo.auth.validation.emailInvalid'),
        password: z.string().min(8, 'bo.auth.validation.passwordTooShort'),
    }),
}
```

El `BaseBO.validate()` toma esas claves y llama a `this.translate(key)` internamente, retornando el mensaje en el idioma correcto.

Gracias a la refactorización, estas claves ahora gozan de **autocompletado** (VSCode sugerirá las claves disponibles en `AppMessages`).

```typescript
// Ejemplo de uso manual con autocompletado
this.translate('alerts.invalidTx')
```

> [!NOTE]
> Las claves siguen el patrón `bo.{nombreBO}.validation.{campo}{Error}`.

## ¿Cómo sabe el sistema qué idioma usar?

El idioma se define en 3 niveles de prioridad:

1. **Variable de Entorno (`APP_LANG`)**: El idioma por defecto del servidor (e.g. `es`).
2. **Configuración de Usuario**: (Futuro) Podríamos cargar el idioma desde el perfil del usuario `users.language`.

El servicio `i18n.use()` selecciona automáticamente el objeto de mensajes correcto según `currentLocale`.
